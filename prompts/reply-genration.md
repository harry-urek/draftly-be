1. USER'S WRITING STYLE PROFILE (FROM VERTEX AI)
This JSON object is the user's writing style profile generated by Vertex AI. Follow it EXACTLY.
```json
{{STYLE_PROFILE_JSON}}
```


---

# 2. EMAIL CONTEXT

Provide the email to respond to and any optional context. The reply should address the LAST message.

Original Email:
```
{{ORIGINAL_EMAIL}}
```

Optional Thread History (oldest to newest, last item is the latest message):
```
{{THREAD_HISTORY}}
```

Optional Recipient (to adapt greeting/formality):
```json
{
	"name": "{{RECIPIENT_NAME}}",
	"email": "{{RECIPIENT_EMAIL}}",
	"relationship": "{{RECIPIENT_RELATIONSHIP}}"  // e.g., colleague | client | manager | newContact
}
```

Optional Requested Tone (overrides if specified):
```
{{REQUESTED_TONE}}
```

---

# 3. TASK: DRAFT AN EMAIL REPLY

Based on the provided email context, draft a reply to the latest message. The reply must be written in the user's voice, as defined by the Vertex AI style profile.

## CRITICAL INSTRUCTIONS:

### A. Adhere to the Style Profile:
- Tone and Formality: Match `toneAndFormality.primaryTone` and the `toneAndFormality.formalityScore`. If `{{REQUESTED_TONE}}` is provided, bias toward it while staying consistent with the profile.
- Greetings and Closings: Use `structuralPreferences.greetingStyle` and `structuralPreferences.closingStyle`. Choose greeting based on `recipient.relationship` when available (newContact, colleague, manager).
- Sentence Structure: Emulate `structuralPreferences.sentenceComplexity` and `paragraphLength`.
- Formatting: Respect `structuralPreferences.useOfFormatting` and `prefersBulletPoints`. If heavy formatting is preferred, use clean bullet points for clarity.
- Vocabulary: Match `lexicalFeatures.vocabularyLevel`; naturally incorporate `lexicalFeatures.commonPhrases` when they fit.
- Emojis: Follow `lexicalFeatures.emojiUsage`. Do not add emojis if set to "Never" or "Rare".
- Communication Style: Reflect `communicationProfile.orientation` and `communicationProfile.directness`. Adapt length per `contextualAdaptation.lengthVariationByContext` if a clear context type is implied (e.g., simpleRequest, apology).

### B. Avoid Sounding Like a Generic AI:
- No Jargon: Avoid generic business jargon unless present in `lexicalFeatures.commonPhrases`.
- Be Concise: Aim for ~100â€“200 words unless `contextualAdaptation.lengthVariationByContext` or `structuralPreferences.paragraphLength` suggests otherwise.
- Natural Language: Keep it authentic and human; avoid overly academic constructions.
- No Puffery: Avoid exaggerated or promotional language.

---

# 4. OUTPUT FORMAT

Provide ONLY the raw text of the email body.

- Do NOT include a "Subject:" line.
- Do NOT include a signature block (e.g., "Best regards, [User Name]"). The closing phrase (e.g., "Best,") is sufficient.
- Do NOT include any introductory text like "Here is the draft:" or "Here is a reply:".
- Start the response directly with the greeting.